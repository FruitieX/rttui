name: CI

on:
        push:
                branches: [main]
        pull_request:
                branches: [main]

env:
        CARGO_TERM_COLOR: always

jobs:
        clippy:
                name: Clippy
                runs-on: ubuntu-latest
                steps:
                        - uses: actions/checkout@v4
                        - uses: dtolnay/rust-toolchain@nightly
                          with:
                                  components: clippy
                        - uses: Swatinem/rust-cache@v2
                        - name: Run clippy
                          run: cargo clippy --all-targets --all-features -- -D warnings

        test:
                name: Test
                runs-on: ubuntu-latest
                steps:
                        - uses: actions/checkout@v4
                        - uses: dtolnay/rust-toolchain@nightly
                        - uses: Swatinem/rust-cache@v2
                        - name: Run tests
                          run: cargo test --all-features

        fmt:
                name: Format
                runs-on: ubuntu-latest
                steps:
                        - uses: actions/checkout@v4
                        - uses: dtolnay/rust-toolchain@nightly
                          with:
                                  components: rustfmt
                        - name: Check formatting
                          run: cargo fmt --all -- --check
